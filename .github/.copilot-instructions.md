# tfskel Project - GitHub Copilot Instructions

## Project Context
This is a CLI tool written in Go for scaffolding Terraform projects with best-practice directory structures and templated files.

## Technology Stack
- Language: Go 1.22+
- CLI Framework: cobra + viper
- Template Engine: text/template (Go standard library)
- Testing: testify/assert
- Build: goreleaser

## Code Style and Standards

### Go Best Practices
- Follow Go's official style guide and effective Go principles
- Use `gofmt` and `golangci-lint` for all code
- Prefer composition over inheritance
- Keep functions small and focused (max 50 lines)
- Use descriptive variable names; avoid single-letter names except for short-lived loop counters
- Write self-documenting code with minimal comments
- Add godoc comments for all exported functions, types, and packages

You are assisting with tfskel, a Go CLI tool.

#### Rules:
- Always write tests for new code
- Always run tests after making changes
- Do not run terraform commands
- Prefer small, testable functions
- Use go:embed for templates
- Avoid premature interfaces
- Use Cobra for CLI
- All file system operations go through an abstraction
- No network calls unless explicitly requested

Project goals:
- Generate Terraform project skeletons
- Opinionated defaults
- Config-first design


### Error Handling
- Always check and handle errors; never use `_` to ignore errors
- Wrap errors with context using `fmt.Errorf("context: %w", err)`
- Return errors instead of panicking unless it's truly unrecoverable
- Use custom error types for domain-specific errors

### Project Structure

```bash
├── cmd
│   ├── drift.go
│   ├── generate.go
│   ├── init.go
│   ├── init_test.go
│   └── root.go
│
├── internal
│   ├── app
│   │   ├── generator.go
│   │   └── generator_test.go
│   ├── config
│   │   ├── config.go
│   │   └── config_test.go
│   ├── drift
│   │   ├── analyzer.go
│   │   ├── analyzer_test.go
│   │   ├── detector.go
│   │   ├── detector_test.go
│   │   ├── detector_test_improvements.md
│   │   ├── formatter.go
│   │   ├── formatter_test.go
│   │   ├── types.go
│   │   └── types_test.go
│   ├── fs
│   │   ├── fs.go
│   │   ├── fs_test.go
│   │   └── memory_fs.go
│   ├── logger
│   │   ├── logger.go
│   │   └── logger_test.go
│   ├── templates
│   │   ├── files
│   │   │   ├── github
│   │   │   ├── root
│   │   │   │   ├── trivy.yaml.tmpl
│   │   │   │   ├── .pre-commit-config.yaml.tmpl
│   │   │   │   ├── .terraform-version.tmpl
│   │   │   │   ├── .tflint.hcl.tmpl
│   │   │   │   └── .gitignore.tmpl
│   │   │   └── tf
│   │   │       ├── backend.tf.tmpl
│   │   │       └── versions.tf.tmpl
│   │   ├── renderer.go
│   │   └── renderer_test.go
│   └── util
│       ├── transform.go
│       └── transform_test.go
│
└── main.go
```

### Testing Requirements
- Minimum 80% code coverage
- Unit tests for all public functions
- Table-driven tests for functions with multiple scenarios
- Integration tests for CLI commands
- Use testify/assert for assertions
- Mock external dependencies using interfaces

### CLI Design
- Commands should be intuitive and follow common CLI patterns
- Use consistent flag naming across commands
- Provide both short (`-d`) and long (`--dir`) flag forms
- Include helpful examples in command help text
- Validate input early and provide clear error messages
- Support both interactive and non-interactive modes

### Template Handling
- Store templates in `templates/` directory using embed.FS
- Use Go's text/template for all templating
- Validate template syntax at build time
- Provide sensible defaults for all template variables
- Allow users to override default templates

### Security
- Never log sensitive information (API keys, secrets)
- Validate all user input and file paths
- Use filepath.Clean() for all file path operations
- Avoid command injection when executing external commands

### Performance
- Minimize external dependencies
- Use buffered I/O for file operations
- Implement concurrent operations where appropriate (e.g., generating multiple files)
- Profile and optimize hot paths

## Commit Message Format
Follow conventional commits:
- feat: New feature
- fix: Bug fix
- docs: Documentation changes
- test: Test additions or changes
- refactor: Code refactoring
- chore: Maintenance tasks

Example: `feat(generate): add support for custom template directories`

## Documentation
- Update README.md for user-facing changes
- Add godoc comments for all exported APIs
- Include code examples in documentation
- Document all CLI flags and commands
- Update docs with every significant change with rules
  - docs/tfskel-book.md with all details, components
  - docs/architecture.md , explaining API architecture
  - docs/golang.md explaining the concepts used in development
